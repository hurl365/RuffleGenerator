<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>STL Generator Viewer</title>
  <style>
    body { margin: 0; font-family: sans-serif; }
    canvas { width: 100vw; height: 100vh; display: block; }
    form { position: absolute; z-index: 1; background: rgba(255,255,255,0.9); padding: 10px; top: 10px; left: 10px; border-radius: 8px; }
    input, label { display: block; margin: 5px 0; }
  </style>
</head>
<body>
  <form id="paramsForm">
    <label>numFolds: <input type="number" name="numFolds" value="5" min="1" max="100"></label>
    <label>minRuffleWidth: <input type="number" name="minRuffleWidth" value="0.1" step="0.01"></label>
    <label>maxRuffleWidth: <input type="number" name="maxRuffleWidth" value="0.3" step="0.01"></label>
    <label>minBaseWidth: <input type="number" name="minBaseWidth" value="0.1" step="0.01"></label>
    <label>maxBaseWidth: <input type="number" name="maxBaseWidth" value="0.3" step="0.01"></label>
    <label>minHeight: <input type="number" name="minHeight" value="0.1" step="0.01"></label>
    <label>maxHeight: <input type="number" name="maxHeight" value="0.3" step="0.01"></label>
    <label>symmetricFold: <input type="checkbox" name="symmetricFold" checked></label>
    <label>seed: <input type="number" name="seed" placeholder="Optional"></label>
    <button type="submit">Generate</button>
  </form>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js';
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js';
    import { STLLoader } from 'https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/STLLoader.js';

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    const controls = new OrbitControls(camera, renderer.domElement);
    camera.position.set(0, 0, 5);
    controls.update();

    const light = new THREE.DirectionalLight(0xffffff, 1);
    light.position.set(1, 1, 1).normalize();
    scene.add(light);

    let mesh;
    function loadSTL(url) {
      const loader = new STLLoader();
      loader.load(url, geometry => {
        if (mesh) scene.remove(mesh);
        const material = new THREE.MeshStandardMaterial({ color: 0x0055ff });
        mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);
      });
    }

    document.getElementById('paramsForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const params = new URLSearchParams(new FormData(e.target)).toString();
      loadSTL(`/generate-stl?${params}`);
    });

    loadSTL('/generate-stl'); // initial default load

    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();
  </script>
</body>
</html>